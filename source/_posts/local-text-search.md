---
title: 【个人项目】医学行业求职者搜索工具
date: 2024-09-25 20:51:27
categories:
- 个人项目
tags: 
- Redis 
- Scrapy
---


## 项目背景

### 目标
为医科工作者提供招聘信息聚合服务，主流的聚合招聘平台关于医师招聘的关键信息划分不清楚，搜索出来的结果中经常包含明显的不符合条件的，比如学历不符合、规培不符合、年龄不符合，另外大部分医院不会选择在一个平台上发布信息，有的在公众号，有的在网站，有的在APP，求职信息搜索花费的时间占比非常多。项目目标是支持按照城市抓取、按照医院关键字抓取，然后求职者设置筛选条件和排序方式，如果搜索条件查到的列表有更新，就通知求职者查看新的招聘信息，求职者可以收藏和管理投递信息。

### 开发资源
+ 人力技术：写过爬虫；Spring Boot后端项目可以快速在之前的脚手架上开发；刚接触VUE
+ 服务器：没有服务器，有的话估计也只能是2核2G的服务器，简直就是要饭的。（预告：看后面我怎么省钱）
+ 时间：时间还算比较自由

## 功能模块
### 筛选模块
功能点：筛选模块
描述：通过属性列的值来筛选，展示属性列可以设置，
设置后的属性列根据用户值保存，搜索条件默认保存上一次的搜索条件。
设置展示列，表格中展示哪些列
点击搜索后，提交筛选条件。
选择筛选条件过程中，比如地点选择了重庆，那么已有的筛选条件，就限制了医院名称列的候选项。
示例：点击年龄35以下，本科学历或者学历不限，消化科，发布时间最近3天、最近10天、最近一个月、最近半个月，信息来源，所在地点。

### 排序模块
功能点：排序模块
描述：默认按照发布时间排序。同时要有分页功能

### 采集模块
功能点：Scrapy采集模块
描述：设置采集的网站，采集的网址，清洗数据后，保存下来，目前暂时保存到ES中，方便全文索引。唯一id，然后记录爬取过的网址，不重复爬取，每天增量采集新的职位信息。


## 框架选择
这个项目类似于内容管理系统，内容由爬虫抓取获得。前端的关键是多筛选框搜索设计，服务端的关键是搜索接口的搭建，前端传过来的字段，服务端负责全文搜索查询。

最开始的想法是这样：
+ 后端：Spring Boot
+ 前端展示：VUE
+ 数据爬取：Scrapy
+ 全文搜索引擎：ElasticSearch

在项目开发过程中，我思考我应该先开发那个模块。我最终选择先开发数据抓取模块，原因有以下：
+ 如果没有前端，我可以先评估抓取难度，如果前端展示和CRUD接口都编写好了，但是爬虫无法采集，并不能让用户使用。
+ 前端展示，虽然我是抱着实践最近学的VUE，但是从0开始自己去写，不如先借鉴学习成熟的办法。

## 项目开发
### 数据采集
1. 数据采集，刚开始花了一天时间写网页抓取，熟悉Scrapy框架。
2. 定义抓取字段，调试网页字段。（CSS和XPATH选择各有优点，前端class会有随机的id，通过CSS无法确保下一次请求是否可以解析到，但是XPATH直接选择html的路径就好）
3. **调试抓取逻辑**：异常捕获处理和异常上下文到日志文件中
4. **避免重复抓取**：榨干本地Redis，且看下文
5. 保存
6. 解决反爬
7. 增量采集
8. 正式环境爬取

解决了下列问题：
+ 被抓取网页采用的是弹性布局：CSS由于class属性带随机id无法选择，XPATH不同页面的同一位置可能是不同的模块，模块不是固定的。
+ 调试过程中，Scrapy shell，会打开pipeline，pipeline初始化会覆盖抓取好的数据。这块我思考传递一个参数，写到不同的文件中，比如items-dev.json，items-prod.json。但是这样需要爬虫调试运行时和正式运行时给不同的配置。最终爬虫在不同的目录下运行，层级结构一样。


### 搜索服务
#### 技术选型
+ 成本： 我并不想盲目租用一个云服务器，但是本地安装一个Elasticsearch，内存并不一定够。
+ 选择：在调研了解后，我选用了[zincsearch](https://zincsearch-docs.zinc.dev/)，一个支持全文搜索的单机数据库。

## 难点
+ 机器资源不可能去在一个服务器上，跑一个Spring Boot，还要跑ElasticSearch，另外还可能有Redis。
+ 使用Redis RDB和AOF解决，每次运行时重复抓取的问题。关掉服务后，如果不保留在磁盘上，后续又会重新抓取。
+ zincsearch项目索引的数据稍微多一点，就崩溃。这点自己通过拆分出更多的分片来解决的。
+ zincsearch并没有完善的中文文档，应用还不太广泛

## 最终完成
+ 数据采集模块：解决了重复抓取、流量检测反爬
+ 搜索服务模块：业务相关的DSL，通过脚本查询zincsearch，导出符合求职者的结果。

## TODO
+ 前端展示模块开发


## 一些思考
+ 项目的目标，解决什么问题，可以解决到什么程度，需要经常练习和复盘
+ 大的通用的框架并不是万能的，在资源受限时使用一些小巧占用资源少的应用，更考验开发者的技术组合能力。
+ 解决问题，越简单的可能越通用，尽量减少引入的工具。比如本地Redis来保存爬过的网站。最开始我打算用MySQL保存，因为我不可能自己电脑一直开着，后来通过Redis持久化配置，这里RDB不保留过期时间，AOF才保留，这里的配置也是加深了自己对Redis的了解。
+ 技术栈选择，随着开发，其实完全不需要Spring Boot，Python在整个项目中，开发更快速，技术栈更统一。
+ 现在，我对Redis、zincsearch的好感爆棚。